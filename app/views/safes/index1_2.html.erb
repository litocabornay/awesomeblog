<% provide(:title,"スロット履歴") %>

<% 
session.delete(:fowarding_url)
store_location 
%>
    
    
<div class="row">


<div class="container-fluid" style="margin-right: 20px; margin-left: 20px;"> 
<h3 class="float-left" style="margin-top: -5px; " ><b>　<i class='fa fa-cube'></i> スロット履歴</b></h3>

<div class="float-right" style="margin-right: 40px;" >

<div class="btn-group float-left" style="margin-right: 40px;"  >
<a href="/safes" class="btn btn-default"><i class="fa fa-bars"></i> パチンコ</a>
<a href="/slot_history" class="btn btn-default"><i class="fa fa-bolt"></i> スロット</a>
</div>

<div class="padding1-20 float-left"> 
<%= form_tag("/zaiko", method: "get") do %>
<%= label_tag :maker, "メーカー検索" %>
<%= text_field_tag :maker, params[:maker], :style => "height:35px;" %>
<%= submit_tag "検索" %>
<% end %>
</div>

<div class="padding1-20 float-left" style="margin-right: 20px;" > 
<%= form_tag("/zaiko", method: "get") do %>
<%= label_tag :name, "機器名検索" %>
<%= text_field_tag :name, params[:name], :style => "height:35px;" %>
<%= submit_tag "検索" %>
<% end %>
</div>

<div class="btn-group float-left">
<%= link_to "CSV出力",csv_output_seven_safes_path(format: :csv), :class => "btn btn-danger" %>
</div>

</div>
</div>

<div class="container-fluid" style="margin-right: 20px; margin-left: 20px;">  


<table class="table table-bordered table-hover table-condensed" style="margin-top: 30px; font-size:60%;">
  <thead class="thead-default">
    <tr scope="row">
      <th class="col-md-1"><%= sortable "id", "ID" %></th>    
      <th class="col-md-2"><%= sortable "maker", "メーカー" %></th>
      <th class="col-md-2"><%= sortable "type_machine", "タイプ" %></th>
      <th class="col-md-3"><%= sortable "name", "機種名" %></th>
      <th class="col-md-2"><%= sortable "price_from", "仕入価格" %></th>
      <th class="col-md-1"><%= sortable "place", "倉庫" %></th>
      <th class="col-md-2"><%= sortable "number", "機器番号(QR)" %></th>
      <th class="col-md-1"><%= sortable "created_at", "日付" %></th>
      <th class="col-md-2"><%= sortable "from", "取引先" %></th>
      <th class="col-md-1"><%= sortable "staff", "担当" %></th>
      <th class="col-md-1"><%= sortable "date_of_removal", "撤去日" %></th>
      <th class="col-md-1"><%= sortable "date_of_verification", "検定日" %></th>    
      <th class="col-md-1"><%= sortable "color_of_panel", "パネル" %></th>
      <th class="col-md-2"><%= sortable "remarks", "備考" %></th>
      <th class="col-md-1"><%= sortable "photo", "画像" %></th>
      <th class="col-md-1 text-center">編集</th>
      <th class="col-md-1 text-center">出庫</th>
      <th class="col-md-1 text-center">Pセン</th>
      <th class="col-md-1 text-center">削除</th>
    </tr>
  </thead>
  <tbody>

  <% @safes.each do |safe| %>
        <tr scope="row">
          <td><%= safe.id %></td>
          <td><%= safe.maker %></td>   
          <td><%= safe.type_machine %></td>     
          <td><%= safe.name %></td>
      
          <% unless safe.price_from.blank? %>
          <td class="width5vw"><%= safe.price_from.to_s(:delimited) %> 円</td>
          <% else %>
          <td><%= safe.price_from %> 円</td>
          <% end %>
        
          <td><%= safe.place %></td>

          <td>
           セ：<%= safe.number[-6..-1] %><br>
           枠：<%= safe.number_of_frame[-6..-1] %><br>
           基：<%= safe.number_of_foundation[-6..-1] %>
          </td>

          <td><%= safe.created_at.strftime("%m/%d") %></td>

          <% if safe.status == "出庫済" %>
          入：<%= safe.created_at.strftime("%m/%d") %> <%= safe.from %><br>
          出：<%= safe.updated_at.strftime("%m/%d") %> <%= safe.to %>
          <% else %>
          入：<%= safe.created_at.strftime("%m/%d") %> <%= safe.from %><br>
          出： --- ---
          <% end %>
          </td>
          
          <td>
          <% if safe.status == "出庫済" %>
          入：<%= safe.staff %> <br>
          出：<%= safe.staff_two %>
          <% else %>
          入：<%= safe.staff %> <br>
          出： ---
          <% end %>
       　 </td>


          <td><%= safe.date_of_removal %></td>
          <td><%= safe.date_of_verification %></td>
          <td><%= safe.color_of_panel %></td>
          <td><%= safe.remarks %></td>

          <% unless safe.photo.blank? %>
          <td class="width5vw"><a href="<%= safe.photo %>" ><img src="<%= safe.photo %>" width="40"></a></td>
          <% else %>
          <td class="width5vw"><img src="assets/No-image-found.jpg" width="40"></td>
          <% end %>
        
          <td class="text-center">
          <%= link_to edit2_safes_path(safe), :class => "btn btn-primary" do %>
          <i class="fa fa-pencil-square-o"></i>
          <% end %>
          </td>
          
          <% if safe.status == "出庫済" %>
            <td>出庫済</td>
          <% else %>
            <td class="text-center">
            <%= link_to edit_safe_path(safe, params: { safe: { status: "出庫済"} } ), :class => "btn btn-primary" do %>
            <i class="fa fa-sign-out"></i>
          <% end %>
            </td>
          <% end %>
         
         <td class="text-center">
          <% @utf81 = safe.name.encode(Encoding::SJIS, :invalid => :replace, :undef => :replace) %>
          <% @utf8 = ERB::Util.url_encode(@utf81) %>
          <% @url = "https://www.p-sensor.co.jp/php/search_sale.php?&item=" + @utf8 %>
          <%= link_to "P", @url, :class => "btn btn-primary" %>
         </td>

         <td class="text-center">
          <%= link_to  safe ,method: :delete, data: { confirm: "本当にこの在庫データを削除しますか？" }, :class => "btn btn-primary" do %>
          <i class="fa fa-trash-o"></i>
          <% end %>
         </td>
   
        </tr>
  <% end %>
  </tbody>
</table>


<%= paginate @safes %>

</div>
</div>